---
title: "Changes in Crop Yield"
author: "Corinna Hong"
date: "March 9, 2019"
output: html_document
banner: "img/banners/crops.jfif"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      warning = FALSE,
                      message = FALSE)
```


<style>
p.caption {
  font-size: 0.9em;
  font-style: italic;
  color: grey;
  margin-right: 10%;
  margin-left: 14%;  
  text-align: left;
}
</style>


```{r, load packages}

# Load Packages

library(tidyverse)
library(gganimate)

```

```{r, read data}

# Read in data

fertilizer <- read_csv("fertilizer.csv")
grain <- read_csv("grain.csv")

```

```{r, fig.align = "center", out.width = "70%", fig.cap = "**Trends in Crop Yield.** Changes in U.S. production of four crops (1866-2018). Data accessed at: https://www.ers.usda.gov/data-products/feed-grains-database/feed-grains-yearbook-tables/"}

# Explore patterns in yield over time

yield_animate <- ggplot(grain, aes(x = year, y = yield)) +
  geom_line(aes(color = commodity)) +
  facet_wrap(~commodity, scale = "free") +
  guides(color = FALSE) +
  labs(x = "\nYear", y = "Yield (bushels / acre)\n") +
  theme_classic() +
  transition_reveal(commodity, year) # animate the plot

yield_animate

```

The trend in barley is best described by a linear, low plateau (LLP) model. The overall hockeystick shape of the trend is a plateau until about 1945, then it begins to increase linearly into the 2000s. Corn can also be described by a LLP model. Like barley, the trend for corn is a plateau until about 1945, then it begins to increase linearly into the 2000s. Oats can also be described by a LLP model even though the plateau isn't as pronounced as seen in barley and corn. Once again, the trend is a plateau until about 1945, then a linear increase into the 2000s. Sorghum looks like a combination of LLP and linear, upper plateau. There is a plateau from 1925 to around 1945. After that, sorghum experiences a linear increase until around 1980 where it plateaus again.

### 2. Fertilizer Use

a. 

```{r, fertilizer wrange}

# Wrangle fertilizer data

fertilizer_wrangle <- fertilizer %>% 
  filter(ppa != "NA")

```


```{r, fig.align = "center", fig.cap = "**Fertilizer Use Over Time.** U.S fertilizer use for three classes of fertilizers (1964-2016). Data accessed at: https://www.ers.usda.gov/data-products/fertilizer-use-and-price/"}

fertilizer_graph <- ggplot(fertilizer_wrangle, aes(x = year, y = ppa))+
  geom_line(aes (color = fertilizer)) +
  facet_grid(crop ~ ., scale = "free") +
  labs(x = "\nYear", y = "Fertilizer Use (pounds / acre)\n") +
  guides(color = guide_legend(title = "Fertilizer")) +
  theme(plot.title = element_text(hjust = 0.5)) + # center title
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5)) # rotate x-axis and move labels down

fertilizer_graph

```

b. Nitrogen fertilizer use is highest in corn and wheat. This indicates that corn and wheat are nitrogen limited. Soybeans, on the other hand, are low in nitrogen fertilizer use indicaing that they are not nitrogen limited. Instead, soybeans have the highest potassium use meaning that it is most likely potassium limited. In corn and wheat potassium use is in the middle. Corn and wheat have the lowest phosphate use and phosphate use is soybeans is in the middle.


c. Soybeans are high in potassium fertilizer use, medium in phosphate use, and low in nitrogen use. The low application of nitrogen fertilizer makes sense because soybeans are able to fix atmospheric nitrogen through symbiotic bacteria living in their roots (Hardarzon, 1984). However, minimal application of nitrogen is used to ensure maximum crop yield (Hardarzon, 1984). Soybean yeild can also be increased through the addition of potassium (Pettigrew, 2008). This explains why potassiums fertilizer is used heavily on soybeans. Finally, phosphate is added to ensure nitrate uptake by the plant (Rufty et al.,1993).
 

### 3. Case Study: Corn Yield and Fertilizer Use

a. 

```{r, corn case study data wrangle}

grain_rename <- grain %>%
  rename(crop = commodity)

grain_fertilizer <- full_join(grain_rename, fertilizer, by = c("crop", "year")) # Joined two data frames, r chose to combine by "year" column since they are exactly the same in both data frames. Same capitalization, spacing, spelling, etc.

corn_fertilizer <- grain_fertilizer %>% 
  filter(crop == "Corn") %>% 
  filter(ppa != "NA")

```

```{r, corn case study graph, fig.align = "center"}

corn_graph <- ggplot(corn_fertilizer, aes(x = ppa, y = yield)) +
  geom_point(aes(color = year)) +
  facet_wrap(~fertilizer, scale = "free") +
  labs(x = "\nFertilizer Use (pounds / acre)", y = "Yield (bushels / acre)\n", title = "U.S. Corn Yield from Three Different Classes of Fertilizers (1964-2016)\n") +
  labs(color = "Year") +
  theme_classic()

corn_graph

```

b. For nitrogen fertilizer, it looks like there is a positive linear relationship between fertilizer use and corn yield. However, in phosphate and potassium, this is not the case. For phosphate, it looks like 60 pounds / acre produces the largest corn yield. For potassium, it looks like 80 pounds / acre produces the larger corn yield. 

<br>
**References:**
<br>
The Morning Harvest (Naseem Buras). (2019). Retrieved from: https://unsplash.com/photos/_gR_xZU2KcY

<br>
U.S. Department of Agriculture, Economic Research Service. Yearbook Tables, 2019. https://www.ers.usda.gov/data-products/feed-grains-database/feed-grains-yearbook-tables/.

<br>
U.S. Department of Agriculture, Economic Research Service. Fertilizer Use, 2019. https://www.ers.usda.gov/data-products/fertilizer-use-and-price/